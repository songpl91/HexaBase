# 四边形网格坐标系统可视化验证

这个可视化系统提供了一个完整的验证环境，用于测试和演示四边形网格坐标系统的所有功能。

## 快速开始

### 方法1：使用预设场景
1. 打开 `Assets/Scenes/GridVisualizationDemo.unity` 场景
2. 点击播放按钮
3. 系统会自动设置可视化环境并运行功能测试

### 方法2：手动设置
1. 创建一个新的空场景
2. 添加 `GridVisualizationSetup` 组件到任意GameObject
3. 在Inspector中配置网格参数
4. 点击播放或使用右键菜单 "Setup Visualization Scene"

## 主要组件

### 1. GridVisualizer (网格可视化器)
**位置**: `Assets/Scripts/GridCoordinateSystem/Visualization/GridVisualizer.cs`

**功能**:
- 实时显示网格线和坐标标签
- 鼠标交互选择网格位置
- 可视化邻居关系、路径查找、距离计算
- 范围查询结果显示
- 实时UI信息面板

**交互控制**:
- **左键点击**: 选择网格位置
- **N键**: 切换邻居显示
- **P键**: 切换路径显示  
- **C键**: 清除所有选择

**可配置参数**:
- 网格大小 (宽度x高度)
- 单元大小
- 显示选项 (网格线、坐标、单元编号等)
- 颜色配置 (网格、高亮、邻居、路径等)
- 交互设置

### 2. GridVisualizationSetup (场景设置器)
**位置**: `Assets/Scripts/GridCoordinateSystem/Setup/GridVisualizationSetup.cs`

**功能**:
- 自动配置摄像机和可视化环境
- 创建预设配置
- 一键设置完整的验证场景

**使用方法**:
- 在Inspector中配置参数
- 勾选 "Auto Setup On Start" 自动设置
- 或使用右键菜单手动触发设置

### 3. GridSystemTester (功能测试器)
**位置**: `Assets/Scripts/GridCoordinateSystem/Testing/GridSystemTester.cs`

**功能**:
- 自动化测试所有网格系统功能
- 性能测试和基准测试
- 连续测试模式
- 详细的测试日志输出

**测试内容**:
- 坐标转换 (直角坐标 ↔ 世界坐标 ↔ 索引坐标)
- 邻居查找 (4邻居、8邻居)
- 距离计算 (曼哈顿、欧几里得、切比雪夫)
- 路径查找 (直线路径)
- 范围查询 (矩形、圆形、曼哈顿、切比雪夫)
- 边界检查

## 验证功能

### 1. 坐标系统验证
- **直角坐标系**: 标准的(x,y)坐标，原点在左下角
- **世界坐标系**: Unity的世界空间坐标
- **索引坐标系**: 一维数组索引，用于优化存储

**验证方法**:
- 点击网格查看坐标转换
- 观察UI面板中的坐标信息
- 查看控制台的测试日志

### 2. 邻居关系验证
- **4邻居**: 上下左右相邻的格子
- **8邻居**: 包括对角线的8个相邻格子

**验证方法**:
- 选择一个位置后按N键
- 蓝色框显示邻居位置
- 边界位置的邻居数量会相应减少

### 3. 距离计算验证
- **曼哈顿距离**: |x1-x2| + |y1-y2|
- **欧几里得距离**: √[(x1-x2)² + (y1-y2)²]
- **切比雪夫距离**: max(|x1-x2|, |y1-y2|)

**验证方法**:
- 选择两个位置
- 查看UI面板中的距离信息
- 验证: 曼哈顿距离 ≥ 欧几里得距离 ≥ 切比雪夫距离

### 4. 路径查找验证
- 使用Bresenham算法计算直线路径
- 支持对角线移动

**验证方法**:
- 选择两个位置后按P键
- 紫色线条显示路径
- 箭头指示移动方向

### 5. 范围查询验证
- **矩形范围**: 以指定半径的矩形区域
- **圆形范围**: 欧几里得距离内的所有点
- **曼哈顿范围**: 曼哈顿距离内的所有点
- **切比雪夫范围**: 切比雪夫距离内的所有点

**验证方法**:
- 启用"显示范围查询"选项
- 选择中心点
- 黄色框显示查询结果

## 性能验证

### 自动性能测试
测试器会自动运行性能基准测试：
- 坐标转换性能 (1000次转换)
- 邻居查找性能 (1000次查找)
- 结果显示在控制台

### 手动性能测试
使用右键菜单 "Run Performance Test" 手动触发性能测试。

## 自定义配置

### 网格大小配置
```csharp
// 在GridVisualizer中配置
_cellSize = 1.0f;      // 单元大小
_gridWidth = 10;       // 网格宽度
_gridHeight = 10;      // 网格高度
```

### 颜色配置
```csharp
_gridColor = Color.white;           // 网格线颜色
_hoverColor = Color.green;          // 悬停高亮颜色
_selectedColor = Color.red;         // 选中高亮颜色
_neighborColor = Color.blue;        // 邻居高亮颜色
_pathColor = Color.magenta;         // 路径颜色
```

### 交互配置
```csharp
_selectKey = KeyCode.Mouse0;        // 选择键
_showNeighborsKey = KeyCode.N;      // 显示邻居键
_showPathKey = KeyCode.P;           // 显示路径键
_clearKey = KeyCode.C;              // 清除键
```

## 故障排除

### 常见问题

1. **网格不显示**
   - 确保摄像机是正交模式
   - 检查摄像机位置和大小
   - 确保Gizmos在Scene视图中已启用

2. **鼠标交互不工作**
   - 确保场景中有主摄像机
   - 检查 `_enableMouseInteraction` 是否为true
   - 确保鼠标在Game视图中

3. **测试不运行**
   - 检查 `_runTestsOnStart` 是否为true
   - 查看控制台是否有错误信息
   - 确保GridCoordinateManager已正确初始化

4. **性能问题**
   - 减少网格大小
   - 关闭不必要的显示选项
   - 检查是否有无限循环的连续测试

### 调试信息
所有组件都会在控制台输出详细的调试信息：
- 初始化状态
- 测试结果
- 错误信息
- 性能数据

## 扩展功能

### 添加新的可视化功能
1. 在 `GridVisualizer` 中添加新的绘制方法
2. 在 `OnDrawGizmos()` 中调用新方法
3. 添加相应的配置参数

### 添加新的测试
1. 在 `GridSystemTester` 中添加新的测试方法
2. 在 `RunAllTests()` 中调用新测试
3. 添加相应的验证逻辑

### 自定义预设
使用 `GridVisualizationSetup.CreatePreset()` 方法创建自定义配置预设。

## 技术细节

### 坐标系统
- **原点**: 左下角 (0,0)
- **X轴**: 向右递增
- **Y轴**: 向上递增
- **索引**: 行优先存储 (index = y * width + x)

### 渲染系统
- 使用Unity的Gizmos系统进行可视化
- OnGUI系统显示UI信息
- 实时更新，无需手动刷新

### 内存管理
- 使用对象池减少GC压力
- 缓存常用计算结果
- 避免在Update中创建临时对象

这个可视化系统提供了完整的验证环境，确保四边形网格坐标系统的所有功能都能正确工作。